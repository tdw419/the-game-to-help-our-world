<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PX Runtime - Phase 1 Mirror + Process Monitor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #0a0a0a, #1a1a2e);
            color: #eee;
            font-family: 'Courier New', monospace;
            overflow-x: hidden;
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, #16213e, #0f3460);
            padding: 1rem 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
            border-bottom: 2px solid #67f542;
        }

        .header h1 {
            color: #67f542;
            text-shadow: 0 0 10px #67f542;
            font-size: 1.8rem;
            animation: pulse 3s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .header .subtitle {
            color: #aaa;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        .status-bar {
            background: rgba(0,0,0,0.3);
            padding: 0.5rem 2rem;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .status-item {
            display: flex;
            align-items: center;
            margin: 0.2rem 1rem;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 0.5rem;
            animation: blink 2s infinite;
        }

        .status-online { background: #67f542; }
        .status-warning { background: #ffb347; }
        .status-critical { background: #ff4757; }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }

        .main-container {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 1rem;
            padding: 1rem;
            min-height: calc(100vh - 120px);
        }

        .panel {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border: 1px solid #333;
            border-radius: 12px;
            padding: 1rem;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .panel:hover {
            border-color: #67f542;
            box-shadow: 0 12px 48px rgba(103, 245, 66, 0.1);
        }

        .panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, #67f542, transparent);
            animation: scan 3s infinite;
        }

        @keyframes scan {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .panel-header {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #333;
        }

        .panel-header h2 {
            color: #67f542;
            font-size: 1.2rem;
            margin-left: 0.5rem;
        }

        .panel-icon {
            font-size: 1.5rem;
        }

        .data-section {
            margin: 1rem 0;
            padding: 0.8rem;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            border-left: 3px solid #67f542;
        }

        .metric {
            display: flex;
            justify-content: space-between;
            margin: 0.3rem 0;
            padding: 0.2rem 0;
        }

        .metric-label {
            color: #aaa;
            font-size: 0.85rem;
        }

        .metric-value {
            color: #67f542;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .metric-critical {
            color: #ff4757;
            animation: flash 1s infinite;
        }

        .metric-warning {
            color: #ffb347;
        }

        @keyframes flash {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.5; }
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #333;
            border-radius: 4px;
            overflow: hidden;
            margin: 0.5rem 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #67f542, #45c52a);
            width: 0%;
            transition: width 0.5s ease;
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { background-position: -200px 0; }
            100% { background-position: 200px 0; }
        }

        .log-container {
            background: #0a0a0a;
            border: 1px solid #333;
            border-radius: 6px;
            padding: 0.8rem;
            height: 200px;
            overflow-y: auto;
            font-size: 0.75rem;
            line-height: 1.4;
            margin: 1rem 0;
        }

        .log-entry {
            margin: 0.2rem 0;
            padding: 0.2rem 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .log-timestamp {
            color: #666;
            font-size: 0.7rem;
        }

        .log-critical {
            color: #ff4757;
            background: rgba(255, 71, 87, 0.1);
            padding: 0.3rem;
            border-radius: 3px;
            margin: 0.2rem 0;
        }

        .log-warning {
            color: #ffb347;
            background: rgba(255, 179, 71, 0.1);
            padding: 0.3rem;
            border-radius: 3px;
            margin: 0.2rem 0;
        }

        .log-info {
            color: #67f542;
        }

        .controls {
            display: flex;
            gap: 0.5rem;
            margin: 1rem 0;
            flex-wrap: wrap;
        }

        .btn {
            background: linear-gradient(135deg, #333, #444);
            color: #fff;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-family: inherit;
            font-size: 0.8rem;
            transition: all 0.3s ease;
            border: 1px solid #555;
        }

        .btn:hover {
            background: linear-gradient(135deg, #444, #555);
            box-shadow: 0 0 10px rgba(103, 245, 66, 0.3);
            border-color: #67f542;
        }

        .btn-primary {
            background: linear-gradient(135deg, #67f542, #45c52a);
            color: #000;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff4757, #ff3742);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffb347, #ff9500);
            color: #000;
        }

        .process-list {
            max-height: 180px;
            overflow-y: auto;
        }

        .process-item {
            background: rgba(0,0,0,0.4);
            margin: 0.5rem 0;
            padding: 0.8rem;
            border-radius: 6px;
            border-left: 3px solid #333;
            transition: all 0.3s ease;
        }

        .process-item.critical {
            border-left-color: #ff4757;
            background: rgba(255, 71, 87, 0.1);
        }

        .process-item.warning {
            border-left-color: #ffb347;
            background: rgba(255, 179, 71, 0.1);
        }

        .process-title {
            font-weight: bold;
            color: #67f542;
            margin-bottom: 0.3rem;
        }

        .process-details {
            font-size: 0.75rem;
            color: #aaa;
            line-height: 1.3;
        }

        .services-list {
            color: #888;
            font-size: 0.7rem;
            margin-top: 0.3rem;
            font-style: italic;
        }

        .alert-badge {
            background: #ff4757;
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 10px;
            font-size: 0.7rem;
            margin-left: 0.5rem;
            animation: bounce 1s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-5px); }
            60% { transform: translateY(-3px); }
        }

        .file-types {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.3rem;
            font-size: 0.75rem;
        }

        .footer {
            background: rgba(0,0,0,0.5);
            padding: 1rem;
            text-align: center;
            border-top: 1px solid #333;
            color: #666;
            font-size: 0.8rem;
        }

        @media (max-width: 1200px) {
            .main-container {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (max-width: 768px) {
            .main-container {
                grid-template-columns: 1fr;
            }
            
            .header {
                padding: 1rem;
            }
            
            .status-bar {
                padding: 0.5rem 1rem;
                flex-direction: column;
                align-items: flex-start;
            }
        }

        .connection-status {
            position: fixed;
            top: 10px;
            right: 10px;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            z-index: 1000;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }

        .connection-online {
            background: rgba(103, 245, 66, 0.2);
            border: 1px solid #67f542;
            color: #67f542;
        }

        .connection-offline {
            background: rgba(255, 71, 87, 0.2);
            border: 1px solid #ff4757;
            color: #ff4757;
        }
    </style>
</head>
<body>
    <div class="connection-status" id="connectionStatus">
        ?? Connecting...
    </div>

    <header class="header">
        <h1>?? PX Runtime - Phase 1 Monitor</h1>
        <div class="subtitle">File System Mirror + Process Monitor (svchost.exe & MsMpEng.exe)</div>
    </header>

    <div class="status-bar">
        <div class="status-item">
            <div class="status-dot status-online" id="systemStatus"></div>
            <span id="systemStatusText">System Online</span>
        </div>
        <div class="status-item">
            <div class="status-dot status-online" id="mirrorStatus"></div>
            <span id="mirrorStatusText">Mirror Ready</span>
        </div>
        <div class="status-item">
            <div class="status-dot status-online" id="processStatus"></div>
            <span id="processStatusText">Process Monitor Ready</span>
        </div>
        <div class="status-item">
            <span>Uptime: <span id="uptime">00:00:00</span></span>
        </div>
        <div class="status-item">
            <span>Last Update: <span id="lastUpdate">Never</span></span>
        </div>
    </div>

    <div class="main-container">
        <!-- File System Mirror Panel -->
        <div class="panel">
            <div class="panel-header">
                <span class="panel-icon">??</span>
                <h2>File System Mirror</h2>
            </div>

            <div class="data-section">
                <h3 style="color: #67f542; margin-bottom: 0.5rem;">Phase 1 Progress</h3>
                <div class="progress-bar">
                    <div class="progress-fill" id="mirrorProgress"></div>
                </div>
                <div class="metric">
                    <span class="metric-label">Scan Progress:</span>
                    <span class="metric-value" id="scanProgress">0 items</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Files Mirrored:</span>
                    <span class="metric-value" id="fileCount">0</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Directories:</span>
                    <span class="metric-value" id="dirCount">0</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Total Size:</span>
                    <span class="metric-value" id="totalSize">0 MB</span>
                </div>
            </div>

            <div class="data-section">
                <h3 style="color: #67f542; margin-bottom: 0.5rem;">Priority Breakdown</h3>
                <div id="priorityBreakdown">
                    <div class="metric">
                        <span class="metric-label">CRITICAL:</span>
                        <span class="metric-value" id="criticalCount">0</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">HIGH:</span>
                        <span class="metric-value" id="highCount">0</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">MEDIUM:</span>
                        <span class="metric-value" id="mediumCount">0</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">LOW:</span>
                        <span class="metric-value" id="lowCount">0</span>
                    </div>
                </div>
            </div>

            <div class="controls">
                <button class="btn btn-primary" onclick="startMirror()">Start Mirror</button>
                <button class="btn btn-danger" onclick="stopMirror()">Stop</button>
                <button class="btn" onclick="refreshData()">Refresh</button>
            </div>

            <div class="data-section">
                <h3 style="color: #67f542; margin-bottom: 0.5rem;">Top File Types</h3>
                <div class="file-types" id="fileTypes">
                    <!-- File types will be populated here -->
                </div>
            </div>
        </div>

        <!-- Process Monitor Panel -->
        <div class="panel">
            <div class="panel-header">
                <span class="panel-icon">?</span>
                <h2>Process Monitor</h2>
                <span class="alert-badge" id="alertBadge" style="display: none;">0</span>
            </div>

            <div class="data-section">
                <h3 style="color: #67f542; margin-bottom: 0.5rem;">System Load</h3>
                <div class="metric">
                    <span class="metric-label">Total Disk Usage:</span>
                    <span class="metric-value" id="totalDiskUsage">0 MB/s</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Active Alerts:</span>
                    <span class="metric-value metric-critical" id="activeAlerts">0</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Monitored Processes:</span>
                    <span class="metric-value" id="monitoredCount">0</span>
                </div>
            </div>

            <div class="controls">
                <button class="btn btn-primary" onclick="startProcessMonitor()">Start Monitor</button>
                <button class="btn btn-danger" onclick="stopProcessMonitor()">Stop</button>
                <button class="btn btn-warning" onclick="clearAlerts()">Clear Alerts</button>
            </div>

            <div class="data-section">
                <h3 style="color: #ff4757; margin-bottom: 0.5rem;">?? svchost.exe Processes</h3>
                <div class="process-list" id="svchostList">
                    <div style="color: #666; font-style: italic; font-size: 0.8rem;">No svchost.exe processes detected</div>
                </div>
            </div>

            <div class="data-section">
                <h3 style="color: #ffb347; margin-bottom: 0.5rem;">??? Windows Defender (MsMpEng.exe)</h3>
                <div class="process-list" id="defenderList">
                    <div style="color: #666; font-style: italic; font-size: 0.8rem;">Windows Defender not active</div>
                </div>
            </div>
        </div>

        <!-- Alerts Panel -->
        <div class="panel">
            <div class="panel-header">
                <span class="panel-icon">??</span>
                <h2>Alerts & Suggestions</h2>
            </div>

            <div class="data-section">
                <h3 style="color: #67f542; margin-bottom: 0.5rem;">Alert Summary</h3>
                <div class="metric">
                    <span class="metric-label">Recent Alerts:</span>
                    <span class="metric-value" id="recentAlertCount">0</span>
                </div>
                <div class="metric">
                    <span class="metric-label">svchost.exe Spikes:</span>
                    <span class="metric-value metric-warning" id="svchostAlerts">0</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Defender Spikes:</span>
                    <span class="metric-value metric-warning" id="defenderAlerts">0</span>
                </div>
            </div>

            <div class="controls">
                <button class="btn" onclick="exportAlerts()">Export Log</button>
                <button class="btn btn-danger" onclick="clearAllAlerts()">Clear All</button>
                <button class="btn btn-warning" onclick="showSuggestions()">Suggestions</button>
            </div>

            <div class="log-container" id="alertsLog">
                <div class="log-entry log-info">
                    <span class="log-timestamp">[00:00:00]</span> 
                    PX Runtime Phase 1 initialized - monitoring started
                </div>
            </div>

            <div class="data-section">
                <h3 style="color: #67f542; margin-bottom: 0.5rem;">?? Smart Suggestions</h3>
                <div id="smartSuggestions" style="font-size: 0.8rem; line-height: 1.4;">
                    <div style="color: #aaa;">Analyzing system patterns...</div>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <p>PX Runtime Phase 1 - Real-time File System Mirror & Process Monitor | Focused on svchost.exe & MsMpEng.exe optimization</p>
    </footer>

    <script>
        // Global state
        let startTime = Date.now();
        let mirrorData = {};
        let processData = {};
        let alertsData = [];
        let updateInterval;
        let connectionState = 'connecting';

        // Initialize dashboard
        function initializeDashboard() {
            console.log('?? PX Runtime Phase 1 Dashboard initializing...');
            updateConnectionStatus('connecting');
            startDataRefresh();
            updateUptime();
            setInterval(updateUptime, 1000);
        }

        // Update connection status
        function updateConnectionStatus(status) {
            const statusEl = document.getElementById('connectionStatus');
            connectionState = status;
            
            switch(status) {
                case 'online':
                    statusEl.textContent = '?? Connected';
                    statusEl.className = 'connection-status connection-online';
                    break;
                case 'offline':
                    statusEl.textContent = '?? Offline';
                    statusEl.className = 'connection-status connection-offline';
                    break;
                default:
                    statusEl.textContent = '?? Connecting...';
                    statusEl.className = 'connection-status';
            }
        }

        // Update uptime display
        function updateUptime() {
            const elapsed = Date.now() - startTime;
            const hours = Math.floor(elapsed / 3600000);
            const minutes = Math.floor((elapsed % 3600000) / 60000);
            const seconds = Math.floor((elapsed % 60000) / 1000);
            
            document.getElementById('uptime').textContent = 
                `${hours.toString().padStart(2,'0')}:${minutes.toString().padStart(2,'0')}:${seconds.toString().padStart(2,'0')}`;
        }

        // Start data refresh cycle
        function startDataRefresh() {
            refreshData();
            updateInterval = setInterval(refreshData, 3000); // Update every 3 seconds
        }

        // Main data refresh function
        async function refreshData() {
            try {
                // Try to load mirror data
                await loadMirrorData();
                
                // Try to load process data  
                await loadProcessData();
                
                // Try to load alerts data
                await loadAlertsData();
                
                updateConnectionStatus('online');
                document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString();
                
            } catch (error) {
                console.warn('Data refresh failed:', error);
                updateConnectionStatus('offline');
            }
        }

        // Load mirror data
        async function loadMirrorData() {
            try {
                const response = await fetch('windows_mirror_phase1.json');
                if (response.ok) {
                    const data = await response.json();
                    mirrorData = data;
                    updateMirrorDisplay(data);
                } else {
                    // Use simulated data if file doesn't exist
                    updateMirrorDisplaySimulated();
                }
            } catch (error) {
                updateMirrorDisplaySimulated();
            }
        }

        // Load process data
        async function loadProcessData() {
            try {
                const response = await fetch('process_monitor_data.json');
                if (response.ok) {
                    const data = await response.json();
                    processData = data;
                    updateProcessDisplay(data);
                } else {
                    updateProcessDisplaySimulated();
                }
            } catch (error) {
                updateProcessDisplaySimulated();
            }
        }

        // Load alerts data
        async function loadAlertsData() {
            try {
                const response = await fetch('alerts_data.json');
                if (response.ok) {
                    const data = await response.json();
                    alertsData = data;
                    updateAlertsDisplay(data);
                } else {
                    updateAlertsDisplaySimulated();
                }
            } catch (error) {
                updateAlertsDisplaySimulated();
            }
        }

        // Update mirror display
        function updateMirrorDisplay(data) {
            const stats = data.data ? Object.keys(data.data).length : 0;
            
            document.getElementById('scanProgress').textContent = `${stats.toLocaleString()} items`;
            document.getElementById('mirrorProgress').style.width = Math.min(100, (stats / 10000) * 100) + '%';
            
            // Count files vs directories
            let files = 0, dirs = 0, totalSize = 0;
            let priorities = { CRITICAL: 0, HIGH: 0, MEDIUM: 0, LOW: 0, NORMAL: 0 };
            let fileTypes = {};
            
            if (data.data) {
                Object.values(data.data).forEach(item => {
                    if (item.metadata) {
                        if (item.metadata.is_file) {
                            files++;
                            totalSize += item.metadata.size_mb || 0;
                            const ext = item.metadata.extension || 'no ext';
                            fileTypes[ext] = (fileTypes[ext] || 0) + 1;
                        }
                        if (item.metadata.is_dir) dirs++;
                    }
                    
                    const priority = item.priority || 'NORMAL';
                    priorities[priority] = (priorities[priority] || 0) + 1;
                });
            }
            
            document.getElementById('fileCount').textContent = files.toLocaleString();
            document.getElementById('dirCount').textContent = dirs.toLocaleString();
            document.getElementById('totalSize').textContent = totalSize.toFixed(1) + ' MB';
            
            // Update priority breakdown
            document.getElementById('criticalCount').textContent = priorities.CRITICAL || 0;
            document.getElementById('highCount').textContent = priorities.HIGH || 0;
            document.getElementById('mediumCount').textContent = priorities.MEDIUM || 0;
            document.getElementById('lowCount').textContent = priorities.LOW || 0;
            
            // Update file types
            const fileTypesEl = document.getElementById('fileTypes');
            fileTypesEl.innerHTML = '';
            Object.entries(fileTypes)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 8)
                .forEach(([ext, count]) => {
                    const div = document.createElement('div');
                    div.innerHTML = `<span style="color: #aaa;">${ext}:</span> <span style="color: #67f542;">${count}</span>`;
                    fileTypesEl.appendChild(div);
                });
        }

        // Update mirror display with simulated data
        function updateMirrorDisplaySimulated() {
            const baseCount = Math.floor(Math.random() * 5000) + 2000;
            document.getElementById('scanProgress').textContent = `${baseCount.toLocaleString()} items`;
            document.getElementById('fileCount').textContent = Math.floor(baseCount * 0.7).toLocaleString();
            document.getElementById('dirCount').textContent = Math.floor(baseCount * 0.3).toLocaleString();
            document.getElementById('totalSize').textContent = (Math.random() * 500 + 100).toFixed(1) + ' MB';
            
            document.getElementById('criticalCount').textContent = Math.floor(baseCount * 0.05);
            document.getElementById('highCount').textContent = Math.floor(baseCount * 0.25);
            document.getElementById('mediumCount').textContent = Math.floor(baseCount * 0.35);
            document.getElementById('lowCount').textContent = Math.floor(baseCount * 0.35);
        }

        // Update process display
        function updateProcessDisplay(data) {
            const totalDisk = data.total_disk_usage || 0;
            const alertCount = data.alert_count || 0;
            const monitoredCount = (data.svchost_processes?.length || 0) + (data.msmpe_processes?.length || 0);
            
            document.getElementById('totalDiskUsage').textContent = totalDisk.toFixed(1) + ' MB/s';
            document.getElementById('activeAlerts').textContent = alertCount;
            document.getElementById('monitoredCount').textContent = monitoredCount;
            
            // Update alert badge
            const alertBadge = document.getElementById('alertBadge');
            if (alertCount > 0) {
                alertBadge.textContent = alertCount;
                alertBadge.style.display = 'inline';
            } else {
                alertBadge.style.display = 'none';
            }
            
            // Update svchost processes
            updateProcessList('svchostList', data.svchost_processes || [], 'svchost.exe');
            
            // Update defender processes
            updateProcessList('defenderList', data.msmpe_processes || [], 'MsMpEng.exe');
        }

        // Update process display with simulated data
        function updateProcessDisplaySimulated() {
            const diskUsage = Math.random() * 10;
            const alertCount = diskUsage > 5 ? Math.floor(Math.random() * 3) + 1 : 0;
            
            document.getElementById('totalDiskUsage').textContent = diskUsage.toFixed(1) + ' MB/s';
            document.getElementById('activeAlerts').textContent = alertCount;
            document.getElementById('monitoredCount').textContent = Math.floor(Math.random() * 8) + 2;
            
            // Generate simulated processes
            const simulatedSvchost = [];
            if (Math.random() > 0.3) {
                simulatedSvchost.push({
                    pid: 1234,
                    disk_mbps: Math.random() * 8,
                    cpu_percent: Math.random() * 15,
                    memory_mb: Math.random() * 100 + 50,
                    services: ['WSearch', 'BITS', 'EventLog']
                });
            }
            
            const simulatedDefender = [];
            if (Math.random() > 0.5) {
                simulatedDefender.push({
                    pid: 5678,
                    disk_mbps: Math.random() * 12,
                    cpu_percent: Math.random() * 25,
                    memory_mb: Math.random() * 200 + 100
                });
            }
            
            updateProcessList('svchostList', simulatedSvchost, 'svchost.exe');
            updateProcessList('defenderList', simulatedDefender, 'MsMpEng.exe');
        }

        // Update process list
        function updateProcessList(containerId, processes, processName) {
            const container = document.getElementById(containerId);
            
            if (processes.length === 0) {
                container.innerHTML = `<div style="color: #666; font-style: italic; font-size: 0.8rem;">No ${processName} processes detected</div>`;
                return;
            }
            
            container.innerHTML = '';
            processes.forEach(proc => {
                const div = document.createElement('div');
                const diskUsage = proc.disk_mbps || 0;
                const isHigh = diskUsage > 5;
                const isWarning = diskUsage > 2;
                
                div.className = `process-item ${isHigh ? 'critical' : isWarning ? 'warning' : ''}`;
                
                let html = `
                    <div class="process-title">${processName} (PID: ${proc.pid})</div>
                    <div class="process-details">
                        Disk: <span class="${isHigh ? 'metric-critical' : isWarning ? 'metric-warning' : 'metric-value'}">${diskUsage.toFixed(1)} MB/s</span><br>
                        CPU: ${(proc.cpu_percent || 0).toFixed(1)}% | RAM: ${(proc.memory_mb || 0).toFixed(1)} MB
                `;
                
                if (proc.services && proc.services.length > 0) {
                    html += `<div class="services-list">Services: ${proc.services.slice(0, 3).join(', ')}</div>`;
                }
                
                html += '</div>';
                div.innerHTML = html;
                container.appendChild(div);
            });
        }

        // Update alerts display
        function updateAlertsDisplay(data) {
            const alertsLog = document.getElementById('alertsLog');
            
            if (data.alerts && data.alerts.length > 0) {
                alertsLog.innerHTML = '';
                data.alerts.slice(-10).forEach(alert => {
                    const div = document.createElement('div');
                    div.className = `log-entry ${alert.type === 'critical' ? 'log-critical' : alert.type === 'warning' ? 'log-warning' : 'log-info'}`;
                    div.innerHTML = `
                        <span class="log-timestamp">[${alert.timestamp}]</span>
                        ${alert.message}
                    `;
                    alertsLog.appendChild(div);
                });
                
                // Update counters
                const svchostAlerts = data.alerts.filter(a => a.process === 'svchost.exe').length;
                const defenderAlerts = data.alerts.filter(a => a.process === 'MsMpEng.exe').length;
                
                document.getElementById('recentAlertCount').textContent = data.alerts.length;
                document.getElementById('svchostAlerts').textContent = svchostAlerts;
                document.getElementById('defenderAlerts').textContent = defenderAlerts;
                
                // Auto-scroll to bottom
                alertsLog.scrollTop = alertsLog.scrollHeight;
            }
            
            // Update suggestions
            updateSmartSuggestions();
        }

        // Update alerts display with simulated data
        function updateAlertsDisplaySimulated() {
            // Generate some sample alerts
            const sampleAlerts = [
                { timestamp: new Date().toLocaleTimeString(), message: 'System monitoring active', type: 'info' },
                { timestamp: new Date().toLocaleTimeString(), message: 'Phase 1 mirror scan in progress', type: 'info' }
            ];
            
            if (Math.random() > 0.7) {
                sampleAlerts.push({
                    timestamp: new Date().toLocaleTimeString(),
                    message: 'svchost.exe high disk usage detected - Windows Search indexing',
                    type: 'warning'
                });
            }
            
            updateAlertsDisplay({ alerts: sampleAlerts });
        }

        // Update smart suggestions
        function updateSmartSuggestions() {
            const suggestions = document.getElementById('smartSuggestions');
            
            const tips = [
                '?? Monitor Windows Search during off-peak hours',
                '?? Schedule Windows Defender scans for nighttime',
                '?? Consider disabling Windows Search if not needed',
                '?? Use Task Scheduler to manage system services',
                '?? Check Windows Update settings to reduce background activity'
            ];
            
            suggestions.innerHTML = tips.slice(0, 3).map(tip => 
                `<div style="margin: 0.3rem 0; color: #67f542;">${tip}</div>`
            ).join('');
        }

        // Control functions
        function startMirror() {
            addAlert('Mirror scan started - Phase 1 priority directories', 'info');
            document.getElementById('mirrorStatusText').textContent = 'Mirror Scanning...';
            document.getElementById('mirrorStatus').className = 'status-dot status-warning';
        }

        function stopMirror() {
            addAlert('Mirror scan stopped', 'warning');
            document.getElementById('mirrorStatusText').textContent = 'Mirror Stopped';
            document.getElementById('mirrorStatus').className = 'status-dot status-critical';
        }

        function startProcessMonitor() {
            addAlert('Process monitoring started - targeting svchost.exe & MsMpEng.exe', 'info');
            document.getElementById('processStatusText').textContent = 'Process Monitor Active';
            document.getElementById('processStatus').className = 'status-dot status-online';
        }

        function stopProcessMonitor() {
            addAlert('Process monitoring stopped', 'warning');
            document.getElementById('processStatusText').textContent = 'Process Monitor Stopped';
            document.getElementById('processStatus').className = 'status-dot status-critical';
        }

        function clearAlerts() {
            const alertsLog = document.getElementById('alertsLog');
            alertsLog.innerHTML = '<div class="log-entry log-info"><span class="log-timestamp">[' + new Date().toLocaleTimeString() + ']</span> Alerts cleared</div>';
            
            document.getElementById('recentAlertCount').textContent = '0';
            document.getElementById('svchostAlerts').textContent = '0';
            document.getElementById('defenderAlerts').textContent = '0';
        }

        function clearAllAlerts() {
            clearAlerts();
            addAlert('All alerts and logs cleared', 'info');
        }

        function exportAlerts() {
            const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
            const filename = `px_runtime_alerts_${timestamp}.txt`;
            
            let logContent = 'PX Runtime Phase 1 - Alerts Export\n';
            logContent += '='.repeat(50) + '\n\n';
            logContent += `Export Time: ${new Date().toLocaleString()}\n\n`;
            
            // Get all log entries
            const logEntries = document.querySelectorAll('#alertsLog .log-entry');
            logEntries.forEach(entry => {
                logContent += entry.textContent + '\n';
            });
            
            // Create download
            const blob = new Blob([logContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
            
            addAlert(`Alerts exported to ${filename}`, 'info');
        }

        function showSuggestions() {
            addAlert('Smart suggestions updated based on current system state', 'info');
            updateSmartSuggestions();
        }

        function addAlert(message, type = 'info') {
            const alertsLog = document.getElementById('alertsLog');
            const div = document.createElement('div');
            div.className = `log-entry log-${type}`;
            div.innerHTML = `
                <span class="log-timestamp">[${new Date().toLocaleTimeString()}]</span>
                ${message}
            `;
            alertsLog.appendChild(div);
            alertsLog.scrollTop = alertsLog.scrollHeight;
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initializeDashboard);

        // Add keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey) {
                switch(e.key) {
                    case 'r':
                        e.preventDefault();
                        refreshData();
                        addAlert('Manual refresh triggered', 'info');
                        break;
                    case 's':
                        e.preventDefault();
                        startMirror();
                        break;
                    case 'm':
                        e.preventDefault();
                        startProcessMonitor();
                        break;
                }
            }
        });
    </script>
</body>
</html>